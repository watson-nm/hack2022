<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>I forgot to make a character!</title>
</head>

<body>
  <script src="bundle.js"></script>
  <script>
    // paste bundle.js here
  </script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
  <main>
    <div class="mt-3 mb-3 text-center">
      <h1>I forgot to make a character!</h1>
      <button class="btn btn-primary" onclick="randVals()">
        ROLL!
      </button>
    </div>
    <div class="accordion" id="itemsAccordion">
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingOne">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne"
            aria-expanded="true" aria-controls="collapseOne">
            Character Sheet
          </button>
        </h2>
        <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne"
          data-bs-parent="#itemsAccordion">
          <div class="accordion-body">
            <div class="mb-3">
              <div class="form-floating">
                <input class="form-control" id="characterName" />
                <label for="characterName">Character Name</label>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-2">
                <div class="form-floating">
                  <input class="form-control" id="level" />
                  <label for="level">Level</label>
                </div>
              </div>
              <div class="col-2">
                <div class="form-floating">
                  <input class="form-control" id="class" />
                  <label for="class">Class</label>
                </div>
              </div>
              <div class="col-4">
                <div class="form-floating">
                  <input class="form-control" id="background" />
                  <label for="background">Background</label>
                </div>
              </div>
              <div class="col-4">
                <div class="form-floating">
                  <input class="form-control" id="playerName" />
                  <label for="playerName">Player Name</label>
                </div>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-4">
                <div class="form-floating">
                  <input class="form-control" id="race" />
                  <label for="race">Race</label>
                </div>
              </div>
              <div class="col-4">
                <div class="form-floating">
                  <input class="form-control" id="alignment" />
                  <label for="alignment">Alignment</label>
                </div>
              </div>
              <div class="col-4">
                <div class="form-floating">
                  <input class="form-control" id="experiencePoints" />
                  <label for="experiencePoints">Experience Points</label>
                </div>
              </div>
            </div>
            <hr />
            <div class="row mb-3">
              <div class="col-2">
                <div class="form-floating">
                  <input class="form-control" id="strength" />
                  <label for="strength">Strength</label>
                </div>
              </div>
              <div class="col-2">
                <div class="form-floating">
                  <input class="form-control" id="dexterity" />
                  <label for="dexterity">Dexterity</label>
                </div>
              </div>
              <div class="col-2">
                <div class="form-floating">
                  <input class="form-control" id="constitution" />
                  <label for="constitution">Constitution</label>
                </div>
              </div>
              <div class="col-2">
                <div class="form-floating">
                  <input class="form-control" id="intelligence" />
                  <label for="intelligence">Intelligence</label>
                </div>
              </div>
              <div class="col-2">
                <div class="form-floating">
                  <input class="form-control" id="wisdom" />
                  <label for="wisdom">Wisdom</label>
                </div>
              </div>
              <div class="col-2">
                <div class="form-floating">
                  <input class="form-control" id="charisma" />
                  <label for="charisma">Charisma</label>
                </div>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-3">
                <h6 class="text-center">Saving Throws</h6>
                <div class="row">
                  <div class="col-8">Strength</div>
                  <div class="col-4">
                    <input class="form-control" type="text" id="savingThrowsStrength" />
                  </div>
                </div>
                <div class="row">
                  <div class="col-8">Dexterity</div>
                  <div class="col-4">
                    <input class="form-control" type="text" id="savingThrowsDexterity" />
                  </div>
                </div>
                <div class="row">
                  <div class="col-8">Constitution</div>
                  <div class="col-4">
                    <input class="form-control" type="text" id="savingThrowsConstitution" />
                  </div>
                </div>
                <div class="row">
                  <div class="col-8">Intelligence</div>
                  <div class="col-4">
                    <input class="form-control" type="text" id="savingThrowsIntelligence" />
                  </div>
                </div>
                <div class="row">
                  <div class="col-8">Wisdom</div>
                  <div class="col-4">
                    <input class="form-control" type="text" id="savingThrowsWisdom" />
                  </div>
                </div>
                <div class="row">
                  <div class="col-8">Charisma</div>
                  <div class="col-4">
                    <input class="form-control" type="text" id="savingThrowsCharisma" />
                  </div>
                </div>
              </div>
              <div class="col-9">
                <h6 class="text-center">Skills</h6>
                <div class="row">
                  <div class="col-4">
                    <div class="row">
                      <div class="col-8">Acrobatics <span class="text-muted">(Dex)</span></div>
                      <div class="col-4">
                        <input class="form-control" type="text" id="acrobatics" />
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-8">Animal Handling <span class="text-muted">(Wis)</span></div>
                      <div class="col-4">
                        <input class="form-control" type="text" id="animalHandling" />
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-8">Arcana <span class="text-muted">(Int)</span></div>
                      <div class="col-4">
                        <input class="form-control" type="text" id="arcana" />
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-8">Athletics <span class="text-muted">(Str)</span></div>
                      <div class="col-4">
                        <input class="form-control" type="text" id="athletics" />
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-8">Deception <span class="text-muted">(Cha)</span></div>
                      <div class="col-4">
                        <input class="form-control" type="text" id="deception" />
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-8">History <span class="text-muted">(Int)</span></div>
                      <div class="col-4">
                        <input class="form-control" type="text" id="history" />
                      </div>
                    </div>
                  </div>
                  <div class="col-4">
                    <div class="row">
                      <div class="col-8">Insight <span class="text-muted">(Wis)</span></div>
                      <div class="col-4">
                        <input class="form-control" type="text" id="insight" />
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-8">Intimidation <span class="text-muted">(Cha)</span></div>
                      <div class="col-4">
                        <input class="form-control" type="text" id="intimidation" />
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-8">Investigation <span class="text-muted">(Int)</span></div>
                      <div class="col-4">
                        <input class="form-control" type="text" id="investigation" />
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-8">Medicine <span class="text-muted">(Wis)</span></div>
                      <div class="col-4">
                        <input class="form-control" type="text" id="medicine" />
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-8">Nature <span class="text-muted">(Int)</span></div>
                      <div class="col-4">
                        <input class="form-control" type="text" id="nature" />
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-8">Perception <span class="text-muted">(Wis)</span></div>
                      <div class="col-4">
                        <input class="form-control" type="text" id="perception" />
                      </div>
                    </div>
                  </div>
                  <div class="col-4">
                    <div class="row">
                      <div class="col-8">Performance <span class="text-muted">(Cha)</span></div>
                      <div class="col-4">
                        <input class="form-control" type="text" id="performance" />
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-8">Persuasion <span class="text-muted">(Cha)</span></div>
                      <div class="col-4">
                        <input class="form-control" type="text" id="persuasion" />
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-8">Religion <span class="text-muted">(Int)</span></div>
                      <div class="col-4">
                        <input class="form-control" type="text" id="religion" />
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-8">Sleight of Hand <span class="text-muted">(Dex)</span></div>
                      <div class="col-4">
                        <input class="form-control" type="text" id="sleightOfHand" />
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-8">Stealth <span class="text-muted">(Dex)</span></div>
                      <div class="col-4">
                        <input class="form-control" type="text" id="stealth" />
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-8">Survival <span class="text-muted">(Wis)</span></div>
                      <div class="col-4">
                        <input class="form-control" type="text" id="survival" />
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-4">
                <div class="form-floating">
                  <input class="form-control" id="inspiration" />
                  <label for="inspiration">Inspiration</label>
                </div>
              </div>
              <div class="col-4">
                <div class="form-floating">
                  <input class="form-control" id="proficiencyBonus" />
                  <label for="proficiencyBonus">Proficiency Bonus</label>
                </div>
              </div>
              <div class="col-4">
                <div class="form-floating">
                  <input class="form-control" id="passiveWisdom" />
                  <label for="passiveWisdom">Passive Wisdom</label>
                </div>
              </div>
            </div>
            <hr />
            <div class="row mb-3">
              <div class="col-4">
                <div class="form-floating">
                  <input class="form-control" id="armorClass" />
                  <label for="armorClass">Armor Class</label>
                </div>
              </div>
              <div class="col-4">
                <div class="form-floating">
                  <input class="form-control" id="initiative" />
                  <label for="initiative">Initiative</label>
                </div>
              </div>
              <div class="col-4">
                <div class="form-floating">
                  <input class="form-control" id="speed" />
                  <label for="speed">Speed</label>
                </div>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-4">
                <div class="form-floating">
                  <input class="form-control" id="maxHitPoints" />
                  <label for="maxHitPoints">Maximum Hit Points</label>
                </div>
              </div>
              <div class="col-4">
                <div class="form-floating">
                  <input class="form-control" id="hitPoints" />
                  <label for="hitPoints">Hit Points</label>
                </div>
              </div>
              <div class="col-4">
                <div class="form-floating">
                  <input class="form-control" id="tempHitPoints" />
                  <label for="tempHitPoints">Temporary Hit Points</label>
                </div>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-6">
                <div class="row">
                  <h6 class="text-center">Hit Dice</h6>
                  <div class="col-6">
                    <div class="form-floating">
                      <input class="form-control" id="totalHitDice" />
                      <label for="totalHitDice">Total</label>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="form-floating">
                      <input class="form-control" id="hitDice" />
                      <label for="hitDice">Hit Dice</label>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-6">
                <div class="row">
                  <h6 class="text-center">Death Saves</h6>
                  <div class="col-6">
                    <div class="form-floating">
                      <input class="form-control" id="deathSaveSuccesses" />
                      <label for="deathSaveSuccesses">Successes</label>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="form-floating">
                      <input class="form-control" id="deathSaveFailures" />
                      <label for="deathSaveFailures">Failures</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <hr />
            <div class="row mb-3">
              <div class="col-6">
                <div class="form-floating">
                  <input class="form-control" id="personalityTraits" />
                  <label for="personalityTraits">Personality Traits</label>
                </div>
              </div>
              <div class="col-6">
                <div class="form-floating">
                  <input class="form-control" id="ideals" />
                  <label for="ideals">Ideals</label>
                </div>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-6">
                <div class="form-floating">
                  <input class="form-control" id="bonds" />
                  <label for="bonds">Bonds</label>
                </div>
              </div>
              <div class="col-6">
                <div class="form-floating">
                  <input class="form-control" id="flaws" />
                  <label for="flaws">Flaws</label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingTwo">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
            data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
            Spell Sheet
          </button>
        </h2>
        <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo"
          data-bs-parent="#itemsAccordion">
          <div class="accordion-body">
            <div class="container-fluid">
              <h5 class="text-center">Attacks and Spellcasting</h5>
              <div class="row mb-3">
                <div class="col-4">
                  <h6 class="text-center">Name</h6>
                </div>
                <div class="col-4">
                  <h6 class="text-center">Attack Bonus</h6>
                </div>
                <div class="col-4">
                  <h6 class="text-center">Damage/Type</h6>
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-4">
                  <input class="form-control" id="attackName1" />
                </div>
                <div class="col-4">
                  <input class="form-control" id="attackBonus1" />
                </div>
                <div class="col-4">
                  <input class="form-control" id="attackDamage1" />
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-4">
                  <input class="form-control" id="attackName2" />
                </div>
                <div class="col-4">
                  <input class="form-control" id="attackBonus2" />
                </div>
                <div class="col-4">
                  <input class="form-control" id="attackDamage2" />
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-4">
                  <input class="form-control" id="attackName3" />
                </div>
                <div class="col-4">
                  <input class="form-control" id="attackBonus3" />
                </div>
                <div class="col-4">
                  <input class="form-control" id="attackDamage3" />
                </div>
              </div>
              <textarea class="form-control" id="attackExtra"></textarea>
              <hr />
              <div class="form-floating mb-3">
                <textarea class="form-control" id="proficienciesAndLanguages"></textarea>
                <label for="proficienciesAndLanguages">Other Proficiencies and Languages</label>
              </div>
              <div class="row mb-3">
                <div class="col-1"></div>
                <div class="col-2">
                  <div class="form-floating">
                    <input class="form-control" id="equipmentCP" />
                    <label for="equipmentCP">CP</label>
                  </div>
                </div>
                <div class="col-2">
                  <div class="form-floating">
                    <input class="form-control" id="equipmentSP" />
                    <label for="equipmentSP">SP</label>
                  </div>
                </div>
                <div class="col-2">
                  <div class="form-floating">
                    <input class="form-control" id="equipmentEP" />
                    <label for="equipmentEP">EP</label>
                  </div>
                </div>
                <div class="col-2">
                  <div class="form-floating">
                    <input class="form-control" id="equipmentGP" />
                    <label for="equipmentGP">GP</label>
                  </div>
                </div>
                <div class="col-2">
                  <div class="form-floating">
                    <input class="form-control" id="equipmentPP" />
                    <label for="equipmentPP">PP</label>
                  </div>
                </div>
                <div class="col-1"></div>
              </div>
              <div class="form-floating mb-3">
                <textarea class="form-control" id="equipment"></textarea>
                <label for="equipment">Equipment</label>
              </div>
              <div class="form-floating mb-3">
                <textarea class="form-control" id="featuresAndTraits"></textarea>
                <label for="featuresAndTraits">Features and Traits</label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // API
      async function apiRequest(value) {
        const response = await fetch("https://www.dnd5eapi.co" + value);
        const json = await response.json();
        return json;
      }

      async function randStats(randClass, randRace, randBackground, randAlignment) {
        var strength = 8;
        var dexterity = 8;
        var constitution = 8;
        var intelligence = 8;
        var wisdom = 8;
        var charisma = 8;

        var abilities = [
          strength,
          dexterity,
          constitution,
          intelligence,
          wisdom,
          charisma
        ];

        var points = 25;
        while (points != 0) {
          abilityIndex = Math.floor(Math.random() * 6);
          abilities[abilityIndex] += 1;
          points -= 1;
        }

        var indices = {
          str: 0,
          dex: 1,
          con: 2,
          int: 3,
          wis: 4,
          cha: 5,
        }

        var race = await apiRequest(randRace.url);
        for (const bonus of race.ability_bonuses) {
          abilities[indices[bonus.ability_score.index]] += bonus.bonus;
        }

        document.getElementById("strength").value = abilities[0];
        document.getElementById("dexterity").value = abilities[1];
        document.getElementById("constitution").value = abilities[2];
        document.getElementById("intelligence").value = abilities[3];
        document.getElementById("wisdom").value = abilities[4];
        document.getElementById("charisma").value = abilities[5];

        var throwIds = {
          str: 'savingThrowsStrength',
          dex: 'savingThrowsDexterity',
          con: 'savingThrowsConstitution',
          int: 'savingThrowsIntelligence',
          wis: 'savingThrowsWisdom',
          cha: 'savingThrowsCharisma',
        }

        const clazz = await apiRequest(randClass.url);

        for (const id in throwIds) {
          document.getElementById(throwIds[id]).value = '0';
        }

        for (const savingThrow of clazz.saving_throws) {
          // not sure what saving throws are
          document.getElementById(throwIds[savingThrow.index]).value = Math.floor(abilities[indices[savingThrow.index]] / 2) - 5;
        }

        // select a language from the possibilities
        var selectedLanguages = [];
        if ('languages' in race) {
          for (const l of race.languages.map(i => i.name)) {
            selectedLanguages.push(l);
          }
        }

        var skillMapping = {
          'skill-acrobatics': 'acrobatics',
          'skill-animal-handling': 'animalHandling',
          'skill-arcana': 'arcana',
          'skill-athletics': 'athletics',
          'skill-deception': 'deception',
          'skill-history': 'history',
          'skill-insight': 'insight',
          'skill-intimidation': 'intimidation',
          'skill-investigation': 'investigation',
          'skill-medicine': 'medicine',
          'skill-nature': 'nature',
          'skill-perception': 'perception',
          'skill-performance': 'performance',
          'skill-persuasion': 'persuasion',
          'skill-religion': 'religion',
          'skill-sleight-of-hand': 'sleightOfHand',
          'skill-stealth': 'stealth',
          'skill-survival': 'survival',
        };

        var skillAbility = {
          'skill-acrobatics': 'dex',
          'skill-animal-handling': 'wis',
          'skill-arcana': 'int',
          'skill-athletics': 'str',
          'skill-deception': 'cha',
          'skill-history': 'int',
          'skill-insight': 'wis',
          'skill-intimidation': 'cha',
          'skill-investigation': 'int',
          'skill-medicine': 'wis',
          'skill-nature': 'int',
          'skill-perception': 'wis',
          'skill-performance': 'cha',
          'skill-persuasion': 'cha',
          'skill-religion': 'int',
          'skill-sleight-of-hand': 'dex',
          'skill-stealth': 'dex',
          'skill-survival': 'wis',
        };

        if ('language_options' in race) {
          var possibleLanguages = race.language_options.from.options.map(i => i.item.name);
          for (var i = 0; i < race.language_options.choose; i++) {
            var index = Math.floor(Math.random() * possibleLanguages.length);
            selectedLanguages.push(possibleLanguages[index]);
            possibleLanguages.splice(index, 1);
          }
        }

        document.getElementById("proficienciesAndLanguages").value = selectedLanguages.join(', ');

        // select proficiencies
        var selectedProficiencies = [];
        if ('proficiencies' in clazz) {
          for (const l of clazz.proficiencies) {
            selectedProficiencies.push(l.url);
          }
        }

        if ('proficiency_choices' in clazz) {
          var possibleProficiencies = clazz.proficiency_choices[0].from.options.map(i => i.item.url);
          for (var i = 0; i < clazz.proficiency_choices[0].choose; i++) {
            var index = Math.floor(Math.random() * possibleProficiencies.length);
            selectedProficiencies.push(possibleProficiencies[index]);
            possibleProficiencies.splice(index, 1);
          }
        }

        for (const id in skillMapping) {
          document.getElementById(skillMapping[id]).value = abilities[indices[skillAbility[id]]];
        }

        for (const proficiency of selectedProficiencies) {
          const prof = await apiRequest(proficiency);
          if (prof.type == 'Skills') {
            document.getElementById(skillMapping[prof.index]).value = +document.getElementById(skillMapping[prof.index]).value + 2;
          }
        }
      }

      async function randVals() {
        var classes = await apiRequest("/api/classes");
        var races = await apiRequest("/api/races");
        var backgrounds = await apiRequest("/api/backgrounds");
        var alignments = await apiRequest("/api/alignments");

        var randClass = classes.results[Math.floor(Math.random() * classes.count)];
        var randRace = races.results[Math.floor(Math.random() * races.count)];
        var randBackground = backgrounds.results[Math.floor(Math.random() * backgrounds.count)];
        var randAlignment = alignments.results[Math.floor(Math.random() * alignments.count)];

        document.getElementById('level').value = 1;
        document.getElementById('proficiencyBonus').value = 2;
        var name = document.getElementById("characterName");
        var charClass = document.getElementById("class");
        var race = document.getElementById("race");
        var background = document.getElementById("background");
        var alignment = document.getElementById("alignment");

        name.value = globalThis.generateName();
        charClass.value = randClass.name;
        race.value = randRace.name;
        background.value = randBackground.name;
        alignment.value = randAlignment.name;

        await randStats(randClass, randRace, randBackground, randAlignment);

        // TODO roll skills?
      }

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
      crossorigin="anonymous"></script>
    </div>
  </main>
</body>

</html>